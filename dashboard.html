<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIGNAL · 오늘의 투자 브리핑</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@300;400;500&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0a0b0e; --surface:#111318; --surface2:#1a1d26;
  --border:#2a2d3a; --accent:#c8a96e; --accent2:#4fc3f7;
  --positive:#4caf82; --negative:#e05c5c;
  /* 한국 주식 관례: 상승=빨강, 하락=파랑/초록 */
  --up:#e05c5c; --down:#4caf82;
  --text:#e8e6e0; --muted:#7a7f8e; --dim:#4a4f5e;
  --radius:12px; --gap:1.25rem;
}
[data-theme="light"] {
  --bg:#f5f3ef; --surface:#fff; --surface2:#f0ede8;
  --border:#ddd9d0; --accent:#9a7840; --accent2:#0277bd;
  --positive:#2e7d52; --negative:#c0392b;
  --up:#c0392b; --down:#2e7d52;
  --text:#1a1a1a; --muted:#5a5a6a; --dim:#9a9aaa;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;
  font-weight:300;min-height:100vh;line-height:1.6;transition:background .3s,color .3s}

/* ── HEADER ── */
header{position:sticky;top:0;z-index:100;
  background:rgba(10,11,14,.94);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
  padding:0 2rem;display:flex;align-items:center;justify-content:space-between;height:64px}
[data-theme="light"] header{background:rgba(245,243,239,.94)}
.logo{font-family:'DM Serif Display',serif;font-size:1.3rem;color:var(--accent);
  display:flex;align-items:center;gap:.5rem}
.logo em{color:var(--text);font-style:normal}
.hdr-r{display:flex;align-items:center;gap:.75rem}
.badge{font-family:'IBM Plex Mono',monospace;font-size:.68rem;color:var(--muted);
  background:var(--surface2);border:1px solid var(--border);
  padding:.25rem .6rem;border-radius:4px;white-space:nowrap}
.sync-pill{display:flex;align-items:center;gap:.4rem;
  font-family:'IBM Plex Mono',monospace;font-size:.65rem;color:var(--muted);
  background:var(--surface2);border:1px solid var(--border);
  padding:.25rem .6rem;border-radius:4px}
.dot{width:6px;height:6px;border-radius:50%;background:var(--positive);
  animation:pulse 2s infinite}
.dot.err{background:var(--negative);animation:none}
.dot.loading{background:var(--accent);animation:pulse .8s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.btn-ic{background:var(--surface2);border:1px solid var(--border);color:var(--muted);
  width:34px;height:34px;border-radius:6px;cursor:pointer;
  display:flex;align-items:center;justify-content:center;font-size:.95rem;
  transition:all .2s;position:relative}
.btn-ic:hover{border-color:var(--accent);color:var(--accent)}
/* 툴팁 */
.btn-ic .tooltip{
  display:none;position:absolute;top:calc(100% + 8px);right:0;
  background:var(--surface);border:1px solid var(--border);
  color:var(--text);font-size:.68rem;font-family:'Noto Sans KR',sans-serif;
  white-space:nowrap;padding:.35rem .65rem;border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);z-index:200;line-height:1.4}
.btn-ic:hover .tooltip{display:block}

/* ── LAYOUT ── */
.wrap{max-width:1300px;margin:0 auto;padding:1.75rem var(--gap)}
.row{display:grid;gap:var(--gap);margin-bottom:var(--gap)}
.r1{grid-template-columns:1fr 340px}
.r2{grid-template-columns:1fr}  /* 섹터+종목 세로 배치 */
.r3{grid-template-columns:3fr 2fr}
@media(max-width:1000px){.r1,.r3{grid-template-columns:1fr}}
@media(max-width:600px){.wrap{padding:1rem .75rem}}

/* ── CARD ── */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);
  padding:1.4rem;transition:border-color .2s;
  opacity:0;transform:translateY(10px);animation:fadeUp .45s ease forwards}
.card:hover{border-color:color-mix(in srgb,var(--accent) 50%,transparent)}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.c1{animation-delay:.05s}.c2{animation-delay:.1s}.c3{animation-delay:.15s}
.c4{animation-delay:.2s}.c5{animation-delay:.25s}.c6{animation-delay:.3s}

.lbl{font-family:'IBM Plex Mono',monospace;font-size:.63rem;letter-spacing:.15em;
  text-transform:uppercase;color:var(--accent);margin-bottom:.85rem;
  display:flex;align-items:center;gap:.4rem}
.lbl::before{content:'';width:4px;height:4px;background:var(--accent);
  border-radius:50%;display:inline-block;flex-shrink:0}

/* ── INDICES ── */
.idx-grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
.idx-item{padding:.7rem .8rem;background:var(--surface2);border-radius:8px;
  border:1px solid transparent;transition:border-color .2s}
.idx-item:hover{border-color:var(--border)}
.idx-name{font-family:'IBM Plex Mono',monospace;font-size:.6rem;
  letter-spacing:.1em;text-transform:uppercase;color:var(--dim)}
.idx-val{font-family:'IBM Plex Mono',monospace;font-size:1rem;
  margin:.15rem 0 .1rem;color:var(--text)}
.idx-chg{font-family:'IBM Plex Mono',monospace;font-size:.72rem}
/* 상승=빨강, 하락=초록 (한국 관례) */
.up{color:var(--up)}.down{color:var(--down)}

/* ── SUMMARY ── */
.sum-list{list-style:none;display:flex;flex-direction:column;gap:.65rem}
.sum-list li{display:flex;gap:.7rem;font-size:.87rem;line-height:1.55;
  padding:.6rem .8rem;background:var(--surface2);border-radius:6px;
  border-left:2px solid var(--accent)}
.sum-n{font-family:'IBM Plex Mono',monospace;font-size:.7rem;
  color:var(--accent);min-width:16px;padding-top:1px;flex-shrink:0}

/* ── SECTORS ── */
.sec-list{display:flex;flex-direction:column;gap:.7rem}
.sec-box{padding:1rem 1.2rem;background:var(--surface2);border-radius:10px;
  border:1px solid var(--border);transition:border-color .2s}
.sec-box:hover{border-color:var(--accent)}
.sec-name{font-size:1.1rem;font-weight:700;color:var(--accent);margin-bottom:.4rem}
.sec-desc{font-size:.9rem;color:var(--text);line-height:1.6}

/* ── STOCKS ── */
.stk-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.55rem}
@media(max-width:1000px){.stk-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.stk-grid{grid-template-columns:repeat(2,1fr)}}
.stk-box{padding:.75rem .9rem;background:var(--surface2);border-radius:8px;
  border:1px solid transparent;transition:border-color .2s;text-align:center}
.stk-box:hover{border-color:var(--border)}
.stk-nm{font-size:.85rem;font-weight:500;margin-bottom:.3rem}
.stk-chg{font-family:'IBM Plex Mono',monospace;font-size:.88rem;font-weight:500}

/* ── NEWS ── */
.news-list{display:flex;flex-direction:column}
.news-row{display:flex;gap:.9rem;padding:.8rem 0;border-bottom:1px solid var(--border)}
.news-row:last-child{border-bottom:none}
.news-t{font-family:'IBM Plex Mono',monospace;font-size:.66rem;
  color:var(--dim);min-width:40px;padding-top:2px;flex-shrink:0}
.news-body{flex:1}
.news-hl{font-size:.82rem;color:var(--text);line-height:1.45}
.news-summary{font-size:.75rem;color:var(--muted);line-height:1.45;margin-top:.25rem}
.tag{display:inline-block;font-size:.62rem;font-family:'IBM Plex Mono',monospace;
  padding:.08rem .38rem;border-radius:3px;margin-top:.3rem;
  background:var(--surface2);color:var(--muted);border:1px solid var(--border)}

/* ── RECOMMENDATIONS ── */
.rec-grid{display:grid;grid-template-columns:1fr 1fr;gap:.7rem}
.rec-card{background:var(--surface2);border:1px solid var(--border);
  border-radius:8px;padding:1rem;position:relative;overflow:hidden;transition:border-color .2s}
.rec-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,var(--accent),transparent)}
.rec-card.featured{grid-column:span 2;display:grid;grid-template-columns:1fr auto;gap:1rem}
.rec-card.featured::before{background:linear-gradient(90deg,var(--accent2),transparent)}
.rec-card:hover{border-color:var(--accent)}
.rec-nm{font-size:.9rem;font-weight:500;margin:.15rem 0 .4rem}
.rec-rs{font-size:.75rem;color:var(--muted);line-height:1.45}
.rec-meta{display:flex;gap:.75rem;margin-top:.55rem}
.rec-tf{font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--dim)}
.rec-grade{font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--accent);font-weight:500}
.rec-rating{display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:.2rem;padding:.5rem .85rem;
  background:rgba(79,195,247,.08);border-radius:6px;border:1px solid rgba(79,195,247,.2);
  flex-shrink:0}
.rec-score{font-family:'DM Serif Display',serif;font-size:1.9rem;color:var(--accent2);line-height:1}
.rec-lbl{font-family:'IBM Plex Mono',monospace;font-size:.58rem;color:var(--muted);letter-spacing:.08em}
.disclaimer{font-size:.67rem;color:var(--dim);margin-top:.75rem;line-height:1.5}
@media(max-width:600px){
  .rec-grid{grid-template-columns:1fr}
  .rec-card.featured{grid-column:span 1;grid-template-columns:1fr}
}

/* ── EMPTY STATE ── */
.empty{text-align:center;padding:2.5rem 1rem;color:var(--dim);
  font-family:'IBM Plex Mono',monospace;font-size:.75rem;line-height:1.8}

/* ── PRINT ── */
@media print{
  header{position:static}
  .btn-ic,.hdr-r .sync-pill{display:none}
  body{background:#fff;color:#000}
  .card{border:1px solid #ccc;break-inside:avoid;opacity:1;transform:none;animation:none}
}
</style>
</head>
<body>

<header>
  <div class="logo">◈ SIGNAL <em>· 오늘의 투자 브리핑</em></div>
  <div class="hdr-r">
    <div class="sync-pill">
      <div class="dot loading" id="syncDot"></div>
      <span id="syncTxt">로딩 중...</span>
    </div>
    <div class="badge" id="updBadge">—</div>
    <button class="btn-ic" onclick="toggleTheme()" title="테마 전환">☀
      <span class="tooltip">라이트 / 다크 모드 전환</span>
    </button>
    <button class="btn-ic" onclick="window.print()" title="인쇄 / PDF">⎙
      <span class="tooltip">인쇄 또는 PDF 저장</span>
    </button>
    <button class="btn-ic" onclick="loadData()" title="새로고침">↻
      <span class="tooltip">주요 지수만 리프레시 됩니다.<br>노션 데이터는 매일 오전 8시<br>자동 업데이트됩니다.</span>
    </button>
  </div>
</header>

<div class="wrap">

  <!-- ROW 1: 시장 요약 + 주요 지수 -->
  <div class="row r1">
    <div class="card c1">
      <div class="lbl">시장 3줄 요약</div>
      <ul class="sum-list" id="summaryEl">
        <div class="empty">데이터를 불러오는 중입니다...</div>
      </ul>
    </div>
    <div class="card c2">
      <div class="lbl">주요 지수</div>
      <div class="idx-grid" id="indicesEl">
        <div class="empty" style="grid-column:span 2">로딩 중...</div>
      </div>
    </div>
  </div>

  <!-- ROW 2: 주도 섹터 (위) + 금일 특이 종목 (아래) -->
  <div class="row r2">
    <div class="card c3">
      <div class="lbl">주도 섹터 분석</div>
      <div class="sec-list" id="sectorEl">
        <div class="empty">로딩 중...</div>
      </div>
    </div>
    <div class="card c4">
      <div class="lbl">금일 특이 종목</div>
      <div class="stk-grid" id="stocksEl">
        <div class="empty">로딩 중...</div>
      </div>
    </div>
  </div>

  <!-- ROW 3: 주요 뉴스 + 추천 종목 -->
  <div class="row r3">
    <div class="card c5">
      <div class="lbl">주요 뉴스 요약</div>
      <div class="news-list" id="newsEl">
        <div class="empty">로딩 중...</div>
      </div>
    </div>
    <div class="card c6">
      <div class="lbl">추천 투자 종목</div>
      <div class="rec-grid" id="recEl">
        <div class="empty" style="grid-column:span 2">로딩 중...</div>
      </div>
      <p class="disclaimer" id="disclaimerEl"></p>
    </div>
  </div>

</div>

<script>
// ── 테마
function toggleTheme(){
  const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('theme', t);
}
const st = localStorage.getItem('theme');
if(st) document.documentElement.setAttribute('data-theme', st);

// ── 색상: 상승=빨강(up), 하락=초록(down) — 한국 주식 관례
function updown(pos){ return pos ? 'up' : 'down'; }
function arrow(pos){ return pos ? '▲' : '▼'; }

// ── 숫자 포맷
function fmt(n, dec=2){
  if(n===undefined||n===null||isNaN(n)) return '—';
  return Number(n).toLocaleString('ko-KR',{minimumFractionDigits:dec,maximumFractionDigits:dec});
}

// ── 렌더러
function renderIndices(idx){
  if(!idx){ document.getElementById('indicesEl').innerHTML='<div class="empty" style="grid-column:span 2">지수 데이터 없음</div>'; return; }
  const MAP=[
    {key:'kospi', label:'KOSPI',    dec:0},
    {key:'kosdaq',label:'KOSDAQ',   dec:0},
    {key:'sp500', label:'S&P 500',  dec:0},
    {key:'nasdaq',label:'NASDAQ',   dec:0},
    {key:'usdkrw',label:'USD/KRW',  dec:1},
    {key:'us10y', label:'미국채 10Y',dec:2},
    {key:'wti',   label:'WTI 유가', dec:2},
    {key:'gold',  label:'금 (XAU)', dec:0},
  ];
  document.getElementById('indicesEl').innerHTML = MAP.map(({key,label,dec})=>{
    const d=idx[key]; if(!d) return '';
    return `<div class="idx-item">
      <div class="idx-name">${label}</div>
      <div class="idx-val">${fmt(d.price,dec)}</div>
      <div class="idx-chg ${updown(d.pos)}">${arrow(d.pos)} ${fmt(Math.abs(d.pct),2)}%</div>
    </div>`;
  }).join('');
}

function renderSummary(arr){
  const el=document.getElementById('summaryEl');
  if(!arr?.length){ el.innerHTML='<div class="empty">노션에서 시장 요약을 작성해주세요</div>'; return; }
  el.innerHTML=arr.slice(0,3).map((s,i)=>
    `<li><span class="sum-n">${String(i+1).padStart(2,'0')}</span>${s}</li>`
  ).join('');
}

function renderSectors(arr){
  const el=document.getElementById('sectorEl');
  if(!arr?.length){ el.innerHTML='<div class="empty">섹터 데이터 없음</div>'; return; }
  el.innerHTML=arr.map(s=>
    `<div class="sec-box">
      <div class="sec-name">${s.name}</div>
      <div class="sec-desc">${s.change}</div>
    </div>`
  ).join('');
}

function renderStocks(arr){
  const el=document.getElementById('stocksEl');
  if(!arr?.length){ el.innerHTML='<div class="empty" style="grid-column:span 4">특이 종목 데이터 없음</div>'; return; }
  el.innerHTML=arr.map(s=>
    `<div class="stk-box">
      <div class="stk-nm">${s.name}</div>
      <div class="stk-chg ${updown(s.pos)}">${s.change}</div>
    </div>`
  ).join('');
}

function renderNews(arr){
  const el=document.getElementById('newsEl');
  if(!arr?.length){ el.innerHTML='<div class="empty">뉴스 데이터 없음</div>'; return; }
  el.innerHTML=arr.map(n=>
    `<div class="news-row">
      <div class="news-t">${n.time}</div>
      <div class="news-body">
        <div class="news-hl">${n.headline}</div>
        ${n.summary?`<div class="news-summary">${n.summary}</div>`:''}
        ${n.tag?`<span class="tag">${n.tag}</span>`:''}
      </div>
    </div>`
  ).join('');
}

function renderRec(arr){
  const el=document.getElementById('recEl');
  if(!arr?.length){ el.innerHTML='<div class="empty" style="grid-column:span 2">추천 종목 데이터 없음</div>'; return; }
  el.innerHTML=arr.map((r,i)=>{
    const featured=r.featured||i===0;
    if(featured){
      return `<div class="rec-card featured">
        <div>
          <div class="rec-nm">${r.name}</div>
          <div class="rec-rs">${r.reason}</div>
          <div class="rec-meta">
            ${r.timeframe?`<span class="rec-tf">${r.timeframe}</span>`:''}
            ${r.grade?`<span class="rec-grade">${r.grade}</span>`:''}
          </div>
        </div>
        <div class="rec-rating">
          <div class="rec-score">${r.grade||'A'}</div>
          <div class="rec-lbl">TOP PICK</div>
        </div>
      </div>`;
    }
    return `<div class="rec-card">
      <div class="rec-nm">${r.name}</div>
      <div class="rec-rs">${r.reason}</div>
      <div class="rec-meta">
        ${r.timeframe?`<span class="rec-tf">${r.timeframe}</span>`:''}
        ${r.grade?`<span class="rec-grade">${r.grade}</span>`:''}
      </div>
    </div>`;
  }).join('');
  document.getElementById('disclaimerEl').textContent=
    '* 본 추천은 정보 제공 목적이며 투자 판단의 최종 책임은 투자자 본인에게 있습니다.';
}

// ── 데이터 로드
async function loadData(){
  const dot=document.getElementById('syncDot');
  const txt=document.getElementById('syncTxt');
  dot.className='dot loading';
  txt.textContent='데이터 로딩 중...';
  try{
    const res=await fetch('data.json?t='+Date.now());
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const d=await res.json();
    renderSummary(d.summary);
    renderSectors(d.sectors);
    renderStocks(d.stocks);
    renderNews(d.news);
    renderRec(d.recommendations);
    renderIndices(d.indices);
    document.getElementById('updBadge').textContent=d.updated_kst||'—';
    dot.className='dot';
    txt.textContent='정상 연동됨';
  }catch(e){
    dot.className='dot err';
    txt.textContent='data.json 로드 실패';
    console.error(e);
  }
}

window.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
